<!DOCTYPE HTML>
<html>
  <head>
    <meta charset="UTF-8">
    <title>numbase</title>
    <script type="text/javascript" src="yak.js"></script>
    <script type="text/javascript" src="numbase.js"></script>
    <script type="text/javascript" src="test_numbase.js"></script>
    <link rel="stylesheet" type="text/css" href="numbase.css">
    <style type="text/css">
.toplink { display: inline-block; margin: 0.5em; }
code { font-size: 111%; }
.number-table { text-align: right }
.op_table_legend_cell { border : solid 1px black; padding : 1px 3px 1px 2px; }
    .api-entry { border : solid 2px blue; background-color: wheat; margin : 1em; margin-bottom: 0.1em; margin-top: 1.5em;
                 padding: 1em; display : inline-block; min-width : 300px; }
.happy { color : green }
.sad { color : red }

@media print { .anchor { visibility : hidden; } }
    </style>
  </head>
  <body>

    <script type="text/yak.js">
function () 
{
    var expl_int  = 123
    ,   expl_real = -123.25

    , third_base_link = { "a href='http://web.williams.edu/Mathematics/sjmiller/public_html/105Sp10/addcomments/Hayes_ThirdBase.htm'" : "Third Base" }
    , balanced_ternary_number_string = '_101_1'
    , balanced_ternary_number_html = ynh( balanced_ternary_number_string )
    ,         example_1 = 'numbase.parseInt( "' + balanced_ternary_number_string + '", "b3" )'

    , balanced_ternary_float_string     = 'b3:_10.1_1'
    , balanced_ternary_exp              = '1_10'
    , balanced_ternary_float_string_exp = 'b3:_10.1_1:' + balanced_ternary_exp
    ,                example_2 = 'numbase.parse( "' + balanced_ternary_float_string_exp + '" )'

    , decimal_value = -25
    , convert_to_balanced_ternary_string = 'numbase.str( ' + decimal_value + ', "b3" )'

    , small_decimal_value = -0.25
    , convert_small_value_to_balanced_ternary_string = 'numbase.str( ' + small_decimal_value + ', "b3" )'
    , convert_back_small_value_from_balanced_ternary_string = 'numbase.parse( ' + convert_small_value_to_balanced_ternary_string + ')'


    , h_nbsp    = yak.html( '&nbsp;' )
    , h_ndash   = yak.html( '&ndash;' )
    , h_rArrow  = yak.html( '&nbsp;&rArr;&nbsp;' )
    , h_lrarrow = yak.html( '&nbsp;&lrarr;&nbsp;' )
    , h_rarrow  = yak.html( '&nbsp;&rarr;&nbsp;' )
    ;

    return [

        { p : [ 

            toplink( { 'a href=".."' : 'home' } )
            
            , toplink( { 'a href="http://github.com/glathoud/numbase"' : 'GitHub repository for numbase' } )
            
        ] }

        , { h1 : "numbase" }
        
        , { p : [ 
            { code : 'numbase' }
            , " is a JavaScript implementation to encode and decode string representations of numbers in any base, including balanced bases:"
        ]}

        , { blockquote : [ { code : '<float value>' }, h_lrarrow, { code : '"<string representation>"' }, h_rarrow, '<HTML representation>' ] }
        
        , { p : 'Integer examples:' }
        
        , { blockquote : [ { code : expl_int }, h_lrarrow, { code : '"' + numbase.str( expl_int, 2 )  + '"' }, h_rarrow, ynh_str( expl_int, 2 ), ' (binary)' ] }
        , { blockquote : [ { code : expl_int }, h_lrarrow, { code : '"' + numbase.str( expl_int, 16 ) + '"' }, h_rarrow, ynh_str( expl_int, 16 ), ' (hexadecimal)' ] }
        , { blockquote : [ { code : expl_int }, h_lrarrow, { code : '"' + numbase.str( expl_int, 'b3' ) + '"' }, h_rarrow, ynh_str( expl_int, 'b3' ), '(balanced ternary)' ] }

        , { p : 'Real number examples:' }

        , { blockquote : [ { code : expl_real }, h_lrarrow, { code : '"' + numbase.str( expl_real, 2 )  + '"' }, h_rarrow, ynh_str( expl_real, 2 ), ' (binary)' ] }
        , { blockquote : [ { code : expl_real }, h_lrarrow, { code : '"' + numbase.str( expl_real, 16 ) + '"' }, h_rarrow, ynh_str( expl_real, 16 ), ' (hexadecimal)' ] }
        , { blockquote : [ { code : expl_real }, h_lrarrow, { code : '"' + numbase.str( expl_real, 'b3' ) + '"' }, h_rarrow, ynh_str( expl_real, 'b3' ), ' (balanced ternary, ', ynh( '_100_1' ) , ' is the exponent)' ] }

        , {p : [
             "Inspiration: "
            , third_base_link
            , ", a column from Brian Hayes published in the November-December 2001 issue of American Scientist."
        ] }
        
        // --------------------------------------------------

        , with_anchor( 'h2', 'Bases and digits' )

        , { p : [ 
            "The usual "
            , { strong : "unbalanced" }
            , " bases are supported for "
            , yak.html( "1&nbsp;&le;&nbsp;N&nbsp;&le;&nbsp;36 :" ) 
        ] }
        , { ul : [ 
            { li : "base 2 (binary) uses the digits 0 and 1." }
            , { li : "..." }
            , { li : "base 10 (decimal) uses the digits " + yak.array( 10 ).map( yak.f( "k" ) ).join( ", " ) + "." }
            , { li : "..." }
            , { li : "base 16 (hexadecimal) uses the digits " + yak.array( 16 ).map( yak.f( "k.toString( 16 )" ) ).join( ", " ) + ", with respective decimal values " + yak.array( 16 ).map( yak.f( "k" ) ).join( ", " ) }
            , { li : "..." }
            , { li : "base 36 uses the digits 0, 1, ... , 9, a, b, ... , y, z with respective decimal values 0, 1, ... , 9, 10, 11, ..., 34, 35" }
        ] }
        

        , { p : [ 
            { strong : "Balanced" } 
            , " bases are also supported for "
            , yak.html( "3&nbsp;&le;&nbsp;N&nbsp;&le;&nbsp;70" )
            , '. They use additional "negative digits", marked by an underline:'
        ] }

        , { ul : [ '_z', '_y', '_x' ].map( describe_bb_digit )
            .concat( ' ... ' )
            .concat( [ '_b', '_a', '_9', '_8' ].map( describe_bb_digit ) )
            .concat( ' ... ' )
            .concat( [ '_2', '_1' ].map( describe_bb_digit ) )
            .map( yak.f( '{li:v}' ))
          }
        
        , { p : [
            'For example, in balanced ternary base, digits '
            , ynh( '_1' )
            , ', 0 and 1 are used, and the number '
            , { p : balanced_ternary_number_html }
            , ' has the decimal value -1 * 3^3 + 0 * 3^2 + 1 * 3 - 1 = -25'
        ]
        }

        // --------------------------------------------------

        , with_anchor( 'h2', 'Properties of balanced bases' )

        , with_anchor( 'h4', 'Balanced odd bases' )

        , { p : [ 
            'Negating a number can be done by negating each digit: '
            , ynh( '-_101_1' )
            , ' = '
            , ynh( '10_11' )
            , '. This nifty property reduces substraction to an addition.'
        ]}

        , { p : [ ' More niceties can be found in ', third_base_link, '. ' ] }


        , with_anchor( 'h4', 'Balanced even bases' )
        
        , { p : [
            , 'To have these nice properties for balanced even bases as well, I am using an "extra negative digit". For example, while in balanced base 4, any number could be represented using only four digits ', ynh( '_1, 0, 1, 2' )
            , ', I also use an extra fifth digit ', ynh( '_2' ), '.'
        ]}

        , { p : 'Tradoff:' }

        , { ul : [ 
            { li : '[+] Nice properties like easy negation are valid for balanced even bases as well.' }
            , { li : [ yak.html( '[&ndash;] ' ), ' Some numbers have multiple representations in balanced even bases, e.g. in balanced base 4: '
                       , ynh( '_2' ), ' = ', ynh( '_12' )
                     ]}
        ]}

        // --------------------------------------------------

        , with_anchor( 'h2', 'API usage' )

        , { p : [ 
            'Use the underscore "_" before a negative digit. For example, the balanced ternary number ' 
            , balanced_ternary_number_html 
            , ' can be written in a text editor '
            , { code : '"' + balanced_ternary_number_string + '"' }
        ] }

        , api_entry( 'numbase.parseInt( <intString>, <base> )' ) 
            
        , { p : [ ' converts an integer of any base to a decimal value, for example:' ] }

        , codelines( [
            'var decimal_value = ' + example_1 + ';'
            , '// ' + eval( example_1 )
        ] )

        , api_entry( 'numbase.parse( <fullString> )' )

        , { p : [
            ' converts a float of any base to a decimal value. '
            , { code : '<fullString>' }
            , yak.html( ' contains three parts, separated by column: (1)&nbsp;the base, (2)&nbsp;integer and/or fractional part(s) and (3)&nbsp;an optional exponent. For example the string:' )
        ]}

        , codelines( '"' + balanced_ternary_float_string + '"' )

        , { p : 'represents in balanced ternary base a float with decimal value -1*3 + 0*1 + 1/3 - 1/(3*3) = ' + numbase.parse( balanced_ternary_float_string ) }

        , { p : [ 

            'Let us now append an exponent '
            , ynh( balanced_ternary_exp )
            , ':'
        ]}

        , codelines( '"' + balanced_ternary_float_string_exp + '"' )

        , { p : [
            'This has the effect of multiplying by the decimal value 3^(1*(3*3) - 1*3 + 0) = 3^6 = 729 so that we should obtain the decimal value ' 
            , yak.html( [ numbase.parse( balanced_ternary_float_string ), '*', '729', '=', numbase.parse( balanced_ternary_float_string )*729 ].join( '&nbsp;' ) )
        ] }

        , { p : [ 'Let us check:' ] }

        , codelines( 'var decimal_value_2 = ' + example_2 + ';\n// ' + eval( example_2 ) )
        
        , api_entry( 'numbase.str( <float>, <base> )' )

        , { p : [
             ' converts a JavaScript float value to a string in the given base. Example:'
        ]}

        , codelines( [ 'var balanced_ternary_string = ' + convert_to_balanced_ternary_string + ';'
                       , '// "' + eval( convert_to_balanced_ternary_string ) + '"'
                     ])


        , with_anchor( 'h2', 'Real numbers' )

        , { p : 'Any real number can be encoded, thanks to the optional exponent part. Example:' }

        , codelines((function () {

            var s = eval( convert_small_value_to_balanced_ternary_string )
            ,   s_arr  = s.split( ':' )

            ,   s_num  = s_arr[ 0 ] + ':' + s_arr[ 1 ]
            ,   v_num  = numbase.parse( s_num )

            ,   s_exp = s_arr[ 0 ] + ':' + s_arr[ 2 ]
            ,   v_exp = numbase.parse( s_exp )

            ,   v = v_num * Math.pow( 3, v_exp )
            ;

            return [ 'var small_value_balanced_ternary_string = ' + convert_small_value_to_balanced_ternary_string + ';'
                     , '// "' + s + '"'
                     , '// '
                     , '// where "' + s_arr[ 1 ] + '"'
                     , '// represents in balanced ternary base the decimal value '
                     , '// -1 * 3^34 + 1 * 3^33 - 1 * 3^32 + ... = ' + v_num
                     , '//'
                     , '// and the exponent "' + s_arr[ 2 ] + '"'
                     , '// represents in balanced ternary base the decimal value ' + v_exp
                     , '//'
                     , '// so the that the equivalent decimal number is:'
                     , '//'
                     , '// ' + v_num + ' * 3^' + v_exp + ' = ' + v
                   ];


        })())
                    


        , with_anchor( 'h4', 'Precision' )

        , { p : 
            'Since we have to use a finite number of digits, (small) rounding errors may occur. However, we use a big enough number of digits to remain within the rounding error inherent to the JavaScript 64-bit float representation (52 usable bits, see IEEE 754). Example:'
        }

        , codelines( [ 'var small_value_back_and_forth = ' + convert_back_small_value_from_balanced_ternary_string + ';'
                       , '// ' + eval( convert_back_small_value_from_balanced_ternary_string )
                     ])

        // --------------------------------------------------

        , with_anchor( 'h2', 'A look at balanced base 20' )

        , (function () {

            var arr = [ 0, 1, 2, '...', 9, 10, 11, 12, '...', 18, 19, 20, 21 ];

            return [ { p : 'Decimal values: ' }
                     , { p : arr.join( ', ') }
                     , { p : ' can be written in balanced base 20 respectively as: ' }
                     , { p : [
                         '0'
                , arr.map( _b20number_or_string ).slice( 1 )
            ] }

                   ];

            function _b20number_or_string( x )
            {
                return 'string' === typeof x 
                    ?  x
                    :  [ ', ', ynh_str( x, 'b20' ) ]
                    ;
            }

        })()

        , { p : 'Addition:' }

        , { 'table class="number-table"' : b20_table_content( '+' ) }

        , { p : 'Multiplication:' }

        , { 'table class="number-table"' : b20_table_content( '*' ) }

        // --------------------------------------------------

        , with_anchor( 'h2', 'Why the fuss?' )

        , { p : [

            'Foreign friends complained several times to me that the French language has those mysterious '
            , '"soixante-dix-huit" (60+18) and "quatre-vingt-dix-neuf" (4*20+19) - at least the French spoken in France. '
            , 'Guess what? This has not always been the case, both bases 10 and 20 have been used, depending on the place and time, '
            , 'leading to this beautifully half-hearted result mixing both (', { 'a href="http://french.stackexchange.com/a/1002"' : 'details' }, ').'
            ,  ' Base 20 appears in older languages as well, e.g. those of the Celts and Mayas ('
                  , { 'a href="http://en.wikipedia.org/wiki/Vigesimal"' : 'details' }, ').' 
                ] }
        
        , { p : [ 
            
            'I have been wondering how to write ', h_ndash, ' and think ', h_ndash, ' numbers in base 20 in a way that is somewhat cognitively easy, at least for people who first learnt to count in base 10. ' 
            
        ]}

        , { p : [
            'The digits used in a ', { 'a href="../base20"' : 'previous attempt' }, ' (2012) now seem to me to look too similar to those of the usual base 10. Thus, differentiating between the two may require too much cognitive load. I now (2014) find preferable to stick to the usual letters a,b,c... for digits with equivalent decimal value above 9, like done e.g. by the JavaScript ', {code:'<number>.toString()'},' method.'
        ]}

        , { p : [
            'I recently (2015) read the ', third_base_link, ' article, which lead me to go one step further: if I was going to investigate an unusual '
            , h_ndash, ' at least today ', h_ndash, ' way of counting like base 20, and *not* stop halfway through (like in French), then go for ', { em : 'balanced' }
            , ' base 20. As mentionned above, it has nice properties. Moreover, digits b to k are not needed, which hopefuly means '
            , ' less cognitive load.'
        ] }

        // --------------------------------------------------

        , with_anchor( 'h2', 'Details' )

        , with_anchor( 'h4', 'Rounding in balanced odd bases' )

        , { p : [
            'In balanced odd bases, rounding a real can be done by just removing the digits at the end. For example, in balanced ternary base:'
        ]}

        , { p : ynh( '_101_1.10_1_11_1' ) }

        , { p: [ ' can be rounded to 3 decimal places (after the dot) by simply truncating: ']}
        
        , { p : ynh( '_101_1.10_1' ) }

        , with_anchor( 'h4', 'Rounding in balanced even bases' )

        , { p : [ 'In balanced even bases, rounding works as well by removing the last digit'
                  , h_ndash
                  , ' except when it is a "middle digit", e.g. ', ynh( '_2') , 'or 2 in balanced base 4.'
                ] }

        , { p : 'Rounding examples in balanced base 4:' }
        , { p : [ ynh( '2.12101_1' ), h_rarrow, ynh( '2.121' ), ' (0 is not a middle digit ', h_rArrow, ' simply truncate)' ] }

        , { p : [ ynh( '2.121' ), h_rarrow, ynh( '2.12' ), ' (1 is not a middle digit ', h_rArrow, ' simply truncate)' ] }

        , { p : [ ynh( '2.12' ), h_rarrow, ynh( '2.2' ), ' (2 IS a middle digit ', h_rArrow, 'round up)' ] }

        , { p : [ ynh( '2.1_2' ), h_rarrow, ynh( '2.1' ), ' (2 IS a middle digit ', h_rArrow, 'round up ', h_rArrow, 'happens to be like truncation in this case.)' ] }

        , { p : [ ynh( '2._12' ), h_rarrow, ynh( '2._1' ), ' (' , ynh( '_2' ), ' IS a middle digit ', h_rArrow, 'round up ', h_rArrow, 'happens to be like truncation in this case.)' ] }

        , { p : [ ynh( '2._1_2' ), h_rarrow, ynh( '2._2' ), ' (' , ynh( '_2' ), '  IS a middle digit ', h_rArrow, 'round up)' ] }

        // --------------------------------------------------


        , with_anchor( 'h2', 'Tests' )

        , { 'p id="test-result"' : (function () {
            
            setTimeout(function () {
                
                test_numbase( 'test-result' );
                
            }, 0 );

            return '';

        })() }

        // --------------------------------------------------

        , { hr : null }

        ,  { p : 'By Guillaume Lathoud, February 2015.' }


    ];

    // --- Details

    function api_entry( /*string*/s )
    {
        return { 'blockquote class="api-entry"' : { code : s } };
    }

    function codelines( /*string... | array of string*/arr )
    {
        return { pre : { code : ('string' === typeof arr  ?  Array.prototype.slice.call( arguments )  :  arr).join( '\n' ) } };
    }

    function describe_bb_digit( /*string*/s )
    {
        return describe_number( "b70", s );
    }

    function describe_number( /*string*/base, /*string*/s )
    {
        var x = numbase.parse( base + ':' + s );
        return yak.html(
            numbase.html( s ).join( '' ) + '&nbsp;(decimal value: ' + x + ')'
        );
    }

    function toplink( x ) 
    { 
        return { 'div class="toplink"' : [
            '[', h_nbsp, x, h_nbsp, ']'
        ] };
    }
    
    function with_anchor( tag, content )
    {
        var anchor_id = content.replace( /\W/g, '-' ).toLowerCase();

        return yak.o( 
            tag + ' id="' + anchor_id + '"'
            , [
                content
                , h_nbsp
                , yak.o(
                    'a href="#' + anchor_id + '" class="anchor"'
                    , '#'
                )
            ]
        );
    }
    
    function ynh( s ) { return yak.html( numbase.html( s ).join( '' ) ); }

    function ynh_str( s, base ) { return ynh( numbase.str( s, base ) ); }
    
    function b20_table_content( /*string | function*/op )
    {
        var op_f = yak.f( op )
        ,   hfr  = { tr : _b20_tbody_content_head_foot_row().map( _b20_legend_cell ) }
        ;
        return [ 
            { thead : hfr }
            , { tbody : yak.array( 21 ).map( _b20_tbody_content_one_row ) }
            , { tfoot : hfr }
        ]
        ;

        function _b20_tbody_content_one_row( tmp, i )
        {
            var y = 20 - i
            ,  opca = [ _b20_legend_cell( ynh_str( y, "b20" ) ) ] 
            ;
            return { tr : opca
                     .concat( yak.array( 21 ).map( _b20_tbody_content_one_col ) )
                     .concat( opca )
                   };

            function _b20_tbody_content_one_col( tmp, j )
            {
                var x = j
                ,   z = op_f( y, x )
                ;
                return { td : ynh_str( z, 'b20' ) };
            }
        }

        function _b20_tbody_content_head_foot_row()
        {
            return [ op ]
                .concat( yak.array( 21 ).map( function (v,k) { return ynh_str( k, "b20" ); } ) )
                .concat( [ op ] )
            ;
        }

        function _b20_legend_cell( a )
        {
            return { 'td class="op_table_legend_cell"' : a }
        }
    }


}
    </script>

    <script type="text/javascript">yak.parse();</script>
  </body>
</html>
